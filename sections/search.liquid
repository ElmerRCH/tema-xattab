<!-- sections/search.liquid -->
<section class="w-full max-w-6xl mx-auto p-4">

  {% assign current_page = request.params.page | default: 1 | plus: 0 %}
  {% assign per_page = 10 %}
  {% assign total_results = search.results_count %}
  {% assign total_pages = total_results | divided_by: per_page | ceil %}

  {% if total_results > 0 and search.results.size > 0 %}
      <p class="mb-4 text-gray-700">Mostrando {{ total_results }} resultados para "<strong>{{ search.terms }}</strong>"</p>

      <div class="bg-gray-50 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-5 rounded-md">
        {% for product in search.results %}
          {% if product.object_type == 'product' %}
            <div class="border border-gray-200 bg-white rounded-lg overflow-hidden flex flex-col hover:shadow-lg transition-shadow duration-300">
               <div class="h-56 w-full">
                <a href="{{ product.url }}">
                    <img 
                        width="100"
                        height="100"
                        src="{{ product.featured_image | image_url: width: 600 }}" 
                        alt="{{ product.title }}" 
                        class="w-full h-64 object-cover"
                    />
                </a>
            </div>
              <div class="p-4 flex-grow flex flex-col">
                <a href="{{ product.url }}" class="text-lg font-semibold text-gray-900 hover:text-red-600 mb-2">{{ product.title }}</a>
                <div class="mt-auto">
                  {% if product.price %}
                    <span class="text-red-600 font-bold text-lg">
                      {{ product.price | money }}
                    </span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- PAGINACIÓN ESTÉTICA -->
      <nav aria-label="Paginación de resultados" class="mt-8 flex justify-center space-x-2">
        {% if current_page > 1 %}
          <a
            href="/search?q={{ search.terms | url_encode }}&page={{ current_page | minus: 1 }}"
            class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-gray-300 bg-white text-gray-700 hover:bg-red-600 hover:text-white transition"
            aria-label="Página anterior"
            title="Página anterior"
          >
            &larr;
          </a>
        {% endif %}

        {% for i in (1..total_pages) %}
          {% assign show_page = false %}

          {% if i == 1 %}
            {% assign show_page = true %}
          {% elsif i == total_pages %}
            {% assign show_page = true %}
          {% else %}
            {% assign lower_bound = current_page | minus: 2 %}
            {% assign upper_bound = current_page | plus: 2 %}

            {% if i >= lower_bound and i <= upper_bound %}
              {% assign show_page = true %}
            {% endif %}
          {% endif %}

          {% if show_page %}
            {% if i == current_page %}
              <span
                aria-current="page"
                class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-red-600 bg-red-600 text-white font-semibold"
                title="Página actual {{ i }}"
              >
                {{ i }}
              </span>
            {% else %}
              <a
                href="/search?q={{ search.terms | url_encode }}&page={{ i }}"
                class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-gray-300 bg-white text-gray-700 hover:bg-red-600 hover:text-white transition"
                title="Página {{ i }}"
              >
                {{ i }}
              </a>
            {% endif %}
          {% else %}
            {% comment %}
              Mostrar puntos suspensivos solo si es el primer salto en cada lado
            {% endcomment %}
           {% assign prev_dots_left = lower_bound | minus: 1 %}
{% assign prev_dots_right = upper_bound | plus: 1 %}

{% if i == prev_dots_left or i == prev_dots_right %}
  <span class="inline-flex items-center justify-center w-10 h-10 text-gray-500 select-none">…</span>
{% endif %}

          {% endif %}
        {% endfor %}

        {% if current_page < total_pages %}
          <a
            href="/search?q={{ search.terms | url_encode }}&page={{ current_page | plus: 1 }}"
            class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-gray-300 bg-white text-gray-700 hover:bg-red-600 hover:text-white transition"
            aria-label="Página siguiente"
            title="Página siguiente"
          >
            &rarr;
          </a>
        {% endif %}
      </nav>

  {% else %}
    <p class="text-center text-gray-600 mt-10">No se encontraron productos para "<strong>{{ search.terms }}</strong>".</p>
  {% endif %}
  
</section>

<style>
  /* Responsive para que el formulario y grid se adapten bien */
  @media (max-width: 640px) {
    form {
      flex-direction: column;
    }
    form input {
      border-radius: 0.375rem; /* rounded-md */
      margin-bottom: 0.5rem;
    }
    form button {
      border-radius: 0.375rem; /* rounded-md */
      width: 100%;
    }
  }
</style>
